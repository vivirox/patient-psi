---
import Layout from '../../layouts/Layout.astro';
import { getSharedChat } from '../../lib/api/chat';
import ChatList from '../../components/chat/chat-list';
import Footer from '../../components/common/Footer.astro';
import { formatDate } from '../../lib/utils';

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/404');
}

const chat = await getSharedChat(id);

if (!chat || !chat.sharePath) {
  return Astro.redirect('/404');
}

const title = chat.title?.slice(0, 50) ?? 'Shared Chat';
---

<Layout title={title}>
  <div class="flex-1 space-y-6">
    <div class="border-b bg-background px-4 py-6 md:px-6 md:py-8">
      <div class="mx-auto max-w-2xl">
        <div class="space-y-1 md:-mx-8">
          <h1 class="text-2xl font-bold">{chat.title}</h1>
          <div class="text-sm text-muted-foreground">
            {formatDate(chat.createdAt)} Â· {chat.messages.length} messages
          </div>
        </div>
      </div>
    </div>
    <div class="container mx-auto max-w-3xl">
      <ChatList messages={chat.messages} isShared={true} client:load />
    </div>
  </div>
  <Footer className="py-8" />
</Layout>
